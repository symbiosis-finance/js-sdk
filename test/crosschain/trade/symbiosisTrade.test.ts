import { describe, expect, test } from 'vitest'
import { BigNumber } from 'ethers'
import { SymbiosisTrade } from '../../../src/crosschain/trade/symbiosisTrade.ts'

describe('SymbiosisTrade#patchCalldata', () => {
    const data =
        '0x8f6bdeaa00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000133a5f9fd8a6706869500000000000000000000000000000000000000000000012d44124acae72bb9d7000000000000000000000000cb28fbe3e9c0fea62e0e63ff3f232cecfe555ad400000000000000000000000000000000000000000000000000000000673cc1fe'
    const newAmount = BigNumber.from('1000000000000000000')

    test('amountIn', () => {
        const offset = 100
        const newData = SymbiosisTrade.patchCallData(data, offset, newAmount)
        expect(newData).toEqual(
            '0x8f6bdeaa000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000012d44124acae72bb9d7000000000000000000000000cb28fbe3e9c0fea62e0e63ff3f232cecfe555ad400000000000000000000000000000000000000000000000000000000673cc1fe'
        )
    })
    test('minReceived', () => {
        const offset = 132
        const newData = SymbiosisTrade.patchCallData(data, offset, newAmount)
        expect(newData).toEqual(
            '0x8f6bdeaa00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000133a5f9fd8a670686950000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000cb28fbe3e9c0fea62e0e63ff3f232cecfe555ad400000000000000000000000000000000000000000000000000000000673cc1fe'
        )
    })
})

describe('SymbiosisTrade#getAmountFromCallData', () => {
    const data =
        '0x8f6bdeaa00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000133a5f9fd8a6706869500000000000000000000000000000000000000000000012d44124acae72bb9d7000000000000000000000000cb28fbe3e9c0fea62e0e63ff3f232cecfe555ad400000000000000000000000000000000000000000000000000000000673cc1fe'

    test('amountIn', () => {
        const offset = 100
        const amount = SymbiosisTrade.getAmountFromCallData(data, offset)
        expect(amount.toString()).toEqual('5675110299685167203989')
    })
    test('minReceived', () => {
        const offset = 132
        const amount = SymbiosisTrade.getAmountFromCallData(data, offset)
        expect(amount.toString()).toEqual('5557375031366057179607')
    })
})
